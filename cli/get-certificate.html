<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Acme PHP | Documentation</title>

    <link href="/fonts/fonts.css" rel="stylesheet">
    <link href="/icons/css/font-awesome.min.css" rel="stylesheet">
    <link href="/min/app.css" rel="stylesheet">

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/styles/default.min.css">

    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<header class="header">
    <div class="container">
        <h1 class="header-title">
            <a href="/">Acme PHP</a>
        </h1>

        <nav class="header-menu">
            <ul>
                <li class="current">
                    <a href="/documentation/">
                        Documentation
                    </a>
                </li>
                <li>
                    <a href="https://github.com/acmephp/acmephp">
                        Github
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</header>

<main class="doc-page">
    <div class="container">
        <div class="doc-menu">
            <nav role="navigation">
                <ul class="doc-menu-list">
                                        <li>
                        <h4 class="doc-menu-header">Command line tool</h4>

                        <ul class="doc-menu-sub">
                                                            <li class="">
                                    <a href="https://acmephp.github.io/documentation/">
                                        Introduction and installation
                                    </a>
                                </li>
                                                            <li class="current">
                                    <a href="https://acmephp.github.io/documentation/cli/get-certificate.html">
                                        Get a certificate
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="https://acmephp.github.io/documentation/cli/webserver.html">
                                        Configure your webserver
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="https://acmephp.github.io/documentation/cli/automatic-renewal.html">
                                        Configure automatic renewal (with monitoring)
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="https://acmephp.github.io/documentation/cli/copy-network.html">
                                        Copy your certificate over the network after generation
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="https://acmephp.github.io/documentation/cli/platformsh.html">
                                        Update your platform.sh certificate after generation
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="https://acmephp.github.io/documentation/cli/heroku.html">
                                        Udate your Heroku certificate after generation
                                    </a>
                                </li>
                                                    </ul>
                    </li>
                                        <li>
                        <h4 class="doc-menu-header">Acme PHP library</h4>

                        <ul class="doc-menu-sub">
                                                            <li class="">
                                    <a href="https://acmephp.github.io/documentation/core/introduction.html">
                                        Introduction
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="https://acmephp.github.io/documentation/core/get-started.html">
                                        Get started
                                    </a>
                                </li>
                                                    </ul>
                    </li>
                                        <li>
                        <h4 class="doc-menu-header">SSL library</h4>

                        <ul class="doc-menu-sub">
                                                            <li class="">
                                    <a href="https://acmephp.github.io/documentation/ssl/introduction.html">
                                        Introduction
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="https://acmephp.github.io/documentation/ssl/get-started.html">
                                        Get started
                                    </a>
                                </li>
                                                    </ul>
                    </li>
                                    </ul>
            </nav>
        </div>

        <div class="doc-content">
            <div class="doc-edit">
                <a href="https://github.com/acmephp/documentation">
                    <i class="fa fa-github"></i>
                    <span>Edit on Github</span>
                </a>
            </div>

            <h1 id="get-started-with-acme-php">Get started with Acme PHP</h1>
<p>Now Acme PHP is available on your system (<code>./acmephp.phar --version</code> should display its version),
you can start requesting certificates for your domains using it.</p>
<h2 id="1-register-your-account-private-key-on-the-lets-encryptacme-server">1. Register your account private key on the Let's Encrypt/ACME server</h2>
<p>The first thing we need to do is to generate a global private key (your &quot;account key&quot;) that will be
used for future exchanges with Let's Encyrpt to prove your identity.</p>
<p>To do so, run the following command:</p>
<pre><code class="language-console">php acmephp.phar register youremail@example.com</code></pre>
<p>This command will do four main things:</p>
<ul>
<li>create the <code>~/.acmephp</code> directory where all the data of Acme PHP will be stored</li>
<li>create a default configuration file <code>~/.acmephp/acmephp.conf</code> that you may edit for advanced usages of Acme PHP</li>
<li>generate a key pair for your account and store it in <code>~/.acmephp</code> (in <code>master</code> and <code>backup</code>)</li>
<li>register your account key in the Let's Encrypt/ACME server, associating it with your e-mail adress</li>
</ul>
<h2 id="2-verify-you-own-the-domain-you-want-a-certificate-for">2. Verify you own the domain you want a certificate for</h2>
<p>You can only request certificates for domains you own. To prove that, the Acme PHP client uses a HTTP
challenge.</p>
<p>The principle is quite simple:</p>
<ul>
<li>the Acme PHP client asks the Let's Encrypt server for a token</li>
<li>you expose this token at a specific URL under the domain to check</li>
<li>the Acme PHP client asks the server to check the URL for the token</li>
</ul>
<p>Using this technique, you proved your server is responding behind the concerned domain.</p>
<p><strong>Note:</strong> You only need to prove once that you own a domain (certificates renewals won't require it), as long as
you keep the same account key.</p>
<h3 id="2a-ask-the-server-for-the-token">2a. Ask the server for the token</h3>
<p>Run the <code>authorize</code> command with your domain:</p>
<pre><code class="language-console">php acmephp.phar authorize yourdomain.org

Loading account key pair...
Requesting an authorization token for domain yourdomain.org ...

The authorization token was successfully fetched!

Now, to prove you own the domain yourdomain.org and request certificates for this domain, follow these steps:

    1. Create a text file accessible on URL http://yourdomain.org/.well-known/acme-challenge/ukfMzbSUxNh2TfcR8ysFeV2gMT0nvkvGzSzo4siaIB8
       containing the following content:

       ukfMzbSUxNh2TfcR8ysFeV2gMT0nvkvGzSzo4siaIB8.K5qhJEjwWA-pgtp4BAeyI7kWWpWGFbxEZneBCZeTjSw

    2. Check in your browser that the URL http://yourdomain.org/.well-known/acme-challenge/ukfMzbSUxNh2TfcR8ysFeV2gMT0nvkvGzSzo4siaIB8 returns
       the authorization token above.

    3. Call the check command to ask the server to check your URL:

       php ./acmephp.phar check yourdomain.org</code></pre>
<h3 id="2b-expose-the-token">2b. Expose the token</h3>
<p>As you may have understood, you now need to expose the token
<code>ukfMzbSUxNh2TfcR8ysFeV2gMT0nvkvGzSzo4siaIB8.K5qhJEjwWA-pgtp4BAeyI7kWWpWGFbxEZneBCZeTjSw</code> at the URL
<code>http://yourdomain.org/.well-known/acme-challenge/ukfMzbSUxNh2TfcR8ysFeV2gMT0nvkvGzSzo4siaIB8</code>.</p>
<p>To do so, usually a simple text file in the <code>.well-known/acme-challenge</code> directory under your web root
is enough, named as specified in the URL and containing the token.</p>
<p>Once that's done, make sure your URL works properly: try to access the URL
<code>http://yourdomain.org/.well-known/acme-challenge/ukfMzbSUxNh2TfcR8ysFeV2gMT0nvkvGzSzo4siaIB8</code> and check you see your
token.</p>
<p>If you do see that token, you can now ask the server to check it.</p>
<h3 id="2c-ask-the-server-to-check-your-url">2c. Ask the server to check your URL</h3>
<p>Run the <code>check</code> command with your domain:</p>
<pre><code class="language-console">php acmephp.phar check yourdomain.org

Loading account key pair...
Loading the authorization token for domain yourdomain.org ...
Requesting authorization check for domain yourdomain.org ...

The authorization check was successful!

You are now the proved owner of the domain yourdomain.org.
Please note that you won't need to prove it anymore as long as you keep the same account key pair.

You can now request a certificate for your domain:

   php ./acmephp.phar request yourdomain.org</code></pre>
<p>If there is an issue, you will usually have a message describing the problem. If you are stuck, don't hesitate to
ask on <a href="https://github.com/acmephp/acmephp/issues">Github issues</a>.</p>
<h2 id="3-request-a-certificate-for-your-domain">3. Request a certificate for your domain</h2>
<p>Finally! You are the proved owner of your domain, you can now request and renew a certificate for this domain.</p>
<p>To do so, simply run the <code>request</code> command:</p>
<pre><code class="language-console">php acmephp.phar request yourdomain.org</code></pre>
<p>This command will ask you required informations for the certificate, request it to the server and store it in
the <code>~/.acmephp</code> storage directory.</p>
<p>6 files will be created in the storage directory:</p>
<ul>
<li>
<p><strong>The full-chain certificate</strong> at <code>~/.acmephp/master/certs/yourdomain.org/fullchain.pem</code>.
This file is the certificate itself. You probably want to use this file in your webserver configurationas it
includes all the issuers chain for a better compatibility with old devices.</p>
</li>
<li>
<p><strong>The certificate private key</strong> at <code>~/.acmephp/master/private/yourdomain.org/private.pem</code>.
This file is usually required by the webserver.</p>
</li>
<li>
<p><strong>The chain alone</strong> at <code>~/.acmephp/master/certs/yourdomain.org/chain.pem</code>.
Some webservers requires a separated chain and certificate. This is the chain part, if you need it.</p>
</li>
<li>
<p><strong>The certificate alone</strong> at <code>~/.acmephp/master/certs/yourdomain.org/cert.pem</code>.
Some webservers requires a separated chain and certificate. This is the certificate part, if you need it.</p>
</li>
<li>
<p><strong>The combined certificate</strong> at <code>~/.acmephp/master/certs/yourdomain.org/combined.pem</code>.
Some webservers requires a single file combining the full-chain and the certificate private key.
This is it, if you need it.</p>
</li>
<li><strong>The certificate public key</strong> at <code>~/.acmephp/master/private/yourdomain.org/public.pem</code>.
You probably won't need it, but it's still available here.</li>
</ul>
<h2 id="4-list-your-certificates-and-their-status">4. List your certificates and their status</h2>
<p>Using the command <code>./acmephp.phar status</code>, you can see what certificates are handled by the Acme PHP client
and when they will expire. It's a useful tool to avoid expired certificates:</p>
<pre><code class="language-console">php acmephp.phar status

+------------------------------+----------------------------+---------------------+---------------------+----------------+
| Domain                       | Issuer                     | Valid from          | Valid to            | Needs renewal? |
+------------------------------+----------------------------+---------------------+---------------------+----------------+
| acmephp.titouangalopin.com   | Let's Encrypt Authority X3 | 2016-06-17 13:08:00 | 2016-09-15 13:08:00 | No             |
+------------------------------+----------------------------+---------------------+---------------------+----------------+</code></pre>
<h2 id="5-renew-a-certificate">5. Renew a certificate</h2>
<p>If a certificate will expire soon, you will probably want to renew it. To do so, simply rerun the <code>request</code> command:</p>
<pre><code class="language-console">php acmephp.phar request yourdomain.org</code></pre>
<p>This time, the command won't ask you anything (all the required informations were stored at the first request).
The certificate will be renewed.</p>
<p>Please note that there may be a limit of renewals per day or week depending on the configuration of the ACME server.
Let's Encrypt has this kind of limitation: renew only when required (one week before expiration for instance).</p>
<p>By default, the <code>request</code> command won't renew until one week before the expiration of the certificate. Therefore you
can put it as a CRON every day and it will renew only when required.</p>
<p>Next: <a href="/documentation/cli/webserver.html">Configure your webserver</a></p>
        </div>

        <div class="clearfix"></div>
    </div>
</main>

<footer class="footer">
    <div class="container">
        <nav>
            <ul>
                <li class="footer-column">
                    <h5>
                        Documentation
                    </h5>

                    <ul>
                        <li>
                            <a href="/documentation/">Command line tool</a>
                        </li>
                        <li>
                            <a href="/documentation/core/introduction.html">Acme PHP library</a>
                        </li>
                        <li>
                            <a href="/documentation/ssl/introduction.html">SSL library</a>
                        </li>
                    </ul>
                </li>
                <li class="footer-column">
                    <h5>
                        Contribute
                    </h5>

                    <ul>
                        <li>
                            <a href="https://github.com/acmephp/acmephp">Github repository</a>
                        </li>
                        <li>
                            <a href="https://github.com/acmephp/acmephp/issues">Issues tracker</a>
                        </li>
                        <li>
                            <a href="https://github.com/acmephp/documentation">Improve documentation</a>
                        </li>
                    </ul>
                </li>
                <li class="footer-column">
                    <h5>
                        Connect
                    </h5>

                    <ul>
                        <li>
                            <a href="https://gitter.im/acmephp/acmephp">Gitter</a>
                        </li>
                        <li>
                            <a href="https://twitter.com/acme_php">Twitter</a>
                        </li>
                        <li>
                            <a href="https://github.com/acmephp/acmephp">Github</a>
                        </li>
                    </ul>
                </li>
                <li class="footer-column">
                    <h5>
                        About
                    </h5>

                    <ul>
                        <li>
                            © 2016 Titouan Galopin. All Rights Reserved.
                        </li>
                        <li>
                            Acme PHP is built by
                            <a href="https://twitter.com/titouangalopin">@tgalopin</a> and
                            <a href="https://twitter.com/jderusse">@jderusse</a>
                        </li>
                        <li>
                            Acme PHP source code and documentation are free and open-source under the
                            MIT license
                        </li>
                    </ul>
                </li>
            </ul>
        </nav>

        <div class="clearfix"></div>
    </div>
</footer>

<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
